services:
    mongodb:
        image: mongo:latest
        container_name: mongodb
        ports:
            - "${MONGO_PORT}:27017"
        volumes:
            - mongo-data:/data/db

    mongo-express:
        image: mongo-express
        restart: always
        ports:
            - "8081:8081"
        environment:
            - ME_CONFIG_MONGODB_URL=mongodb://mongodb:${MONGO_PORT}
            - ME_CONFIG_BASICAUTH_ENABLED=false
        depends_on:
            - mongodb

    server:
        build: ./server
        container_name: express
        ports:
            - "${SERVER_PORT}:3000"
        environment:
            - MONGO_URI=mongodb://mongodb:${MONGO_PORT}/visiondb
            - PORT=${SERVER_PORT}
        depends_on:
            - mongodb
        healthcheck:
          test: [ "CMD", "curl", "-f", "http://${DEV_URL}:${SERVER_PORT}/health" ]
          interval: 60s
          timeout: 10s
          retries: 3

    client:
        build: ./client
        container_name: vue
        ports:
            - "${CLIENT_PORT}:8080"
        environment:
          - PORT=${CLIENT_PORT}
          - VITE_SERVER_URL=${DEV_URL}:${SERVER_PORT}
        depends_on:
            - server

volumes:
    mongo-data: